
<%for(let credential of credentials) {%>
  <div id="qrcode-<%=credential.referent%>" style="display: none;" class="hidden-page">
    <style>
      .qr-code-container {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;

        @media screen and (max-width: 50em) {
          width: 100%;
          margin: 8rem 0;
        }
      }

      .qr-code {
        display: flex;
        border-radius: 1rem;
        width: fit-content;
        flex-direction: column;
        justify-content: space-between;
        padding: 2rem;
      }


    </style>
    
      <div class="container-fluid">

        <div class="qr-code-container">
          <div class="qr-code" style></div>
        </div>
      
        <div class="form-horizontal">
          <div class="form-group">
            <label class="control-label col-sm-2"
              for="content">
              Content:
            </label>
            <div class="col-sm-10">
      
              <!-- Input box to enter the 
                  required data -->
              <input type="text" size="60" 
                maxlength="60" class="form-control"
                id="input_text" placeholder="Enter content" />
            </div>
          </div>
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
      
              <!-- Button to generate QR Code for
              the entered data -->
              <button type="button" class=
                "btn btn-default button w3-btn w3-white w3-border" id="generate">
                Generate
              </button>
            </div>
          </div>
        </div>
      </div>      
      <script>
        let btn = document.querySelector(".button");
        let qr_code_element = document.querySelector(".qr-code");

        btn.addEventListener("click", () => {
          let user_input = document.querySelector("#input_text");
          if (user_input.value != "") {
            if (qr_code_element.childElementCount == 0) {
              generate(user_input);
            } else {
              qr_code_element.innerHTML = "";
              generate(user_input);
            }
          } else {
            console.log("not valid input");
            qr_code_element.style = "display: none";
          }
        });

        function generate(user_input) {
          qr_code_element.style = "";

          var qrcode = new QRCode(qr_code_element, {
            text: `${user_input.value}`,
            width: 180, //128
            height: 180,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
          });

          let download = document.createElement("button");
          qr_code_element.appendChild(download);

          let download_link = document.createElement("a");
          download_link.setAttribute("download", "qr_code.png");
          download_link.innerHTML = `Download`;

          download.appendChild(download_link);

          let qr_code_img = document.querySelector(".qr-code img");
          let qr_code_canvas = document.querySelector("canvas");

          if (qr_code_img.getAttribute("src") == null) {
            setTimeout(() => {
              download_link.setAttribute("href", `${qr_code_canvas.toDataURL()}`);
            }, 300);
          } else {
            setTimeout(() => {
              download_link.setAttribute("href", `${qr_code_img.getAttribute("src")}`);
            }, 300);
          }
        }
        let current_url = window.location.href;
        generate({
          value: current_url.replace("#qrcode", "#landing")
        });
      </script>
  </div>
<%}%>
